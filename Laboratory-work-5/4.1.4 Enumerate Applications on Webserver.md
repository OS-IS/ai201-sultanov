# Перелічити додатки на вебсервері
| ID |
|---|
| WSTG-INFO-04 |
## Підсумок
Ключовим кроком у тестуванні вразливостей вебдодатків є виявлення конкретних додатків, які розміщені на вебсервері. Багато додатків мають відомі вразливості та відомі стратегії атак, які можуть бути використані для отримання віддаленого доступу або для компрометації даних. Крім того, багато додатків часто неправильно налаштовані або не оновлюються через сприйняття, що вони використовуються "внутрішньо", і тому не становлять загрози. З поширенням віртуальних вебсерверів традиційне співвідношення типу 1:1 між IP-адресою та вебсервером втрачає своє початкове значення. Нерідко можна зустріти кілька вебсайтів або додатків, символічні імена яких відповідають одній IP-адресі. Цей сценарій характерний не лише для хостинг-середовищ, а й для звичайних корпоративних середовищ.

Іноді спеціалістам із безпеки надається набір IP-адрес як ціль для тестування. Можна стверджувати, що цей сценарій більше схожий на тестування типу "penetration test", але у будь-якому випадку очікується, що таке завдання передбачає перевірку всіх вебдодатків, доступних через цю ціль. Проблема полягає в тому, що надана IP-адреса хостить HTTP-сервіс на порту 80, але якщо тестувальник звернеться до нього, вказавши лише IP-адресу (що є єдиною доступною інформацією), то може отримати повідомлення типу "На цій адресі не налаштовано вебсервер" або подібне. Однак ця система може "ховати" низку вебдодатків, пов’язаних із неочевидними символічними (DNS) іменами. Очевидно, що обсяг аналізу значно залежить від того, чи тестувальник перевіряє всі додатки, чи лише ті, про які йому відомо.

Іноді специфікація цілі є більш детальною. Тестувальнику можуть надати список IP-адрес із відповідними символічними іменами. Проте цей список може містити лише часткову інформацію, тобто деякі символічні імена можуть бути пропущені, і навіть клієнт може не знати про це (це більш імовірно у великих організаціях).

Інші питання, які впливають на обсяг оцінки, включають вебдодатки, опубліковані за неочевидними URL-адресами (наприклад, ```http://www.example.com/some-strange-URL```), які ніде не згадуються. Це може статися або через помилку (через неправильні налаштування), або навмисно (наприклад, приховані адміністративні інтерфейси).

Щоб вирішити ці проблеми, необхідно виконати виявлення вебдодатків.
## Цілі тесту
- Перелічити додатки в межах обраного обсягу, які існують на вебсервері.

## Як тестувати

Виявлення вебдодатків — це процес, спрямований на ідентифікацію вебдодатків в інфраструктурі. Зазвичай інфраструктура визначається як набір IP-адрес (можливо, блок мережі), але також може складатися з набору символічних DNS-імен або їх комбінації. Ця інформація надається перед виконанням оцінки, будь то класичний тест на проникнення чи оцінка, зосереджена на додатках. У будь-якому випадку, якщо правила виконання тесту не визначають інше (наприклад, тестувати лише додаток за URL-адресою ```http://www.example.com/```), оцінка повинна бути максимально комплексною за обсягом, тобто повинна ідентифікувати всі додатки, доступні через задану ціль. Нижче наведено приклади кількох технік, які можуть бути використані для досягнення цієї мети.

*Деякі з наступних методик застосовуються до вебсерверів, які виходять в Інтернет, а саме: DNS і вебсервіси зворотного пошуку IP-адрес, а також використання пошукових систем. Приклади використовують приватні IP-адреси (такі як ```192.168.1.100```), які, якщо не вказано інше, представляють загальні IP-адреси та використовуються виключно для анонімності.*

Існує три фактори, які впливають на те, скільки додатків пов’язано з певним DNS-ім’ям (або IP-адресою):

#### 1. Різні базові URL-адреси
Очевидною точкою входу для вебдодатка є ```www.example.com```, тобто, у скороченій формі ми маємо на увазі, що вебдодаток починається з ```http://www.example.com/``` (те саме стосується https). Проте, навіть якщо це найпоширеніший випадок, немає нічого, що змушує додаток починатися саме з кореневого каталогу ```/```.

Наприклад, одне й те саме символічне ім’я може бути пов’язане з трьома вебдодатками, такими як:
- ```http://www.example.com/url1```
- ```http://www.example.com/url2```
- ```http://www.example.com/url3```

У цьому випадку URL ```http://www.example.com``` не буде пов’язано з жодною змістовною сторінкою, а три додатки залишаться прихованими, якщо тестувальник не знає, як до них дістатися, тобто, якщо тестувальник не знає url1, url2 або url3.

Зазвичай немає необхідності публікувати вебдодатки таким чином, якщо власник не хоче, щоб вони були доступними стандартним способом, і готовий повідомити користувачів про їх точне розташування. Це не означає, що такі додатки є секретними, лише те, що їхнє існування та місцезнаходження не є явно рекламованими.

#### 2. Нестандартні порти
Хоча вебдодатки зазвичай працюють на портах 80 (http) та 443 (https), немає нічого магічного в цих номерах портів. Насправді, вебдодатки можуть бути прив’язані до будь-яких TCP-портів і можуть бути доступні через вказівку номера порту наступним чином: ```http[s]://www.example.com:порт/```. Наприклад, ```http://www.example.com:20000/```.

### 3. Віртуальні хости
DNS дозволяє одному IP-адресу бути пов’язаним з одним або кількома символічними іменами. Наприклад, IP-адреса ```192.168.1.100``` може бути пов’язана з DNS-іменами ```www.example.com```, ```helpdesk.example.com```, ```webmail.example.com```. Не обов’язково, щоб усі ці імена належали до одного й того ж DNS-домену. Це співвідношення 1 до N може бути відображено для подачі різного контенту за допомогою так званих віртуальних хостів. Інформація, що визначає віртуальний хост, до якого ми звертаємось, вбудована в заголовок HTTP 1.1 "Host".

Не було б підозри щодо існування інших вебдодатків, окрім очевидного ```www.example.com```, якщо тестувальник не знає про ```helpdesk.example.com``` або ```webmail.example.com```.

## Підходи до вирішення проблеми 1 - Нестандартні URL-адреси

Не існує способу повністю встановити наявність вебдодатків з нестандартними іменами. Оскільки вони є нестандартними, немає фіксованих критеріїв для визначення назви, проте існує кілька технік, які тестувальник може застосувати для отримання додаткової інформації.

По-перше, якщо вебсервер неправильно налаштований і дозволяє перегляд директорій, можна помітити ці додатки. Сканери вразливостей можуть допомогти в цьому випадку.

По-друге, ці додатки можуть бути згадані на інших вебсторінках, і є ймовірність, що вони були спайдерені та індексовані пошуковими системами. Якщо тестувальники підозрюють існування таких прихованих додатків на ```www.example.com```, вони можуть здійснити пошук за допомогою оператора site і перевірити результат запиту для ```site: www.example.com```. Серед отриманих URL-адрес може бути така, яка вказує на прихований додаток.

Інший варіант — це перевірка URL-адрес, які можуть бути ймовірними кандидатами для неопублікованих додатків. Наприклад, вебпошта може бути доступною за такими URL-адресами, як ```https://www.example.com/webmail```, ```https://webmail.example.com/``` або ```https://mail.example.com/```. Те ж саме стосується адміністративних інтерфейсів, які можуть бути опубліковані за прихованими URL-адресами (наприклад, адміністративний інтерфейс Tomcat), і все ж не згадуються ніде. Таким чином, виконання пошуку в стилі словника (або "інтелектуальне вгадування") може дати деякі результати. Сканери вразливостей також можуть допомогти в цьому випадку.

## Підходи до вирішення проблеми 2 - Нестандартні порти

Легко перевірити наявність вебдодатків на нестандартних портах. Сканер портів, такий як nmap, здатний виконувати розпізнавання сервісів за допомогою опції -sV і ідентифікувати http[s] сервіси на довільних портах. Для цього необхідно провести повний скан всього простору адрес TCP-портів (64k портів).

Наприклад, наступна команда виконає сканування всіх відкритих портів на IP-адресі 192.168.1.100 за допомогою TCP-з'єднання і спробує визначити, які сервіси прив'язані до цих портів (показано лише основні перемикачі — nmap має широкий набір опцій, які не охоплюються в рамках цього опису):

```nmap –Pn –sT –sV –p0-65535 192.168.1.100```

Достатньо проаналізувати результат і шукати "http" або позначення SSL-захищених сервісів (які слід перевірити, щоб підтвердити, що це https). Наприклад, вивід попередньої команди може виглядати так:
```plaintext
Interesting ports on 192.168.1.100:
(The 65527 ports scanned but not shown below are in state: closed)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 3.5p1 (protocol 1.99)
80/tcp    open  http        Apache httpd 2.0.40 ((Red Hat Linux))
443/tcp   open  ssl         OpenSSL
901/tcp   open  http        Samba SWAT administration server
1241/tcp  open  ssl         Nessus security scanner
3690/tcp  open  unknown
8000/tcp  open  http-alt?
8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
```
З цього прикладу видно, що:

На порту 80 працює сервер Apache HTTP.
- Схоже, на порту 443 працює HTTPS-сервер (але це потрібно підтвердити, наприклад, відвідавши ```https://192.168.1.100``` через браузер).
- На порту 901 знаходиться вебінтерфейс Samba SWAT.
- Сервіс на порту 1241 не є HTTPS, а є SSL-захищеним демоном Nessus.
- На порту 3690 працює невизначений сервіс (nmap надає його *фінгерпринт* — тут опущено для простоти — разом з інструкціями щодо подання його для включення в базу фінгерпринтів nmap, якщо відомо, який це сервіс).
- На порту 8000 знаходиться ще один невизначений сервіс; можливо, це HTTP, оскільки HTTP-сервери часто зустрічаються на цьому порту. Розглянемо цю ситуацію:
```
$ telnet 192.168.10.100 8000
Trying 192.168.1.100...
Connected to 192.168.1.100.
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.0 200 OK
pragma: no-cache
Content-Type: text/html
Server: MX4J-HTTPD/1.0
expires: now
Cache-Control: no-cache

<html>
...
```
Це підтверджує, що насправді це HTTP-сервер. Альтернативно, тестувальники могли б відвідати URL-адресу через веббраузер; або використати команди Perl, такі як GET або HEAD, які імітують HTTP-запити, подібні до наведених вище (однак варто зазначити, що деякі сервери можуть не підтримувати HEAD-запити).  

- Apache Tomcat, який працює на порту 8080.

Таке ж завдання можна виконати за допомогою сканерів вразливостей, але перед цим потрібно переконатися, що обраний сканер здатний ідентифікувати HTTP[S]-сервіси на нестандартних портах. Наприклад, Nessus може ідентифікувати такі сервіси на довільних портах (за умови, що йому вказано сканувати всі порти). У порівнянні з nmap, Nessus також виконує кілька тестів на відомі вразливості вебсерверів, а також перевіряє конфігурацію SSL для HTTPS-сервісів. Як зазначалося раніше, Nessus також здатний виявляти популярні додатки чи вебінтерфейси, які могли б залишитися непоміченими (наприклад, адміністративний інтерфейс Tomcat).

## Підходи до вирішення проблеми 3 - Віртуальні хости
Існує кілька технік, які можна використовувати для ідентифікації DNS-імен, пов’язаних із заданою IP-адресою `x.y.z.t`.

### DNS-зональні передачі
Ця техніка сьогодні має обмежене застосування, оскільки зональні передачі здебільшого не підтримуються DNS-серверами. Однак, варто спробувати. Перш за все, тестувальники повинні визначити DNS-сервери, які обслуговують `x.y.z.t`. Якщо символічне ім’я відоме для `x.y.z.t` (наприклад, це `www.example.com`), сервери імен можна визначити за допомогою інструментів, таких як `nslookup`, `host` або `dig`, виконавши запит DNS-записів типу NS.

Якщо для `x.y.z.t` символічні імена невідомі, але визначення цілі містить хоча б одне символічне ім’я, тестувальники можуть спробувати застосувати той самий процес і виконати запит до сервера імен цього імені (сподіваючись, що сервер імен також обслуговує `x.y.z.t`). Наприклад, якщо ціль складається з IP-адреси `x.y.z.t` і імені `mail.example.com`, визначте сервери імен для домену `example.com`.

Наступний приклад показує, як за допомогою команди `host` ідентифікувати сервери імен для `www.owasp.org`:

```
$ host -t ns www.owasp.org
www.owasp.org is an alias for owasp.org.
owasp.org name server ns1.secure.net.
owasp.org name server ns2.secure.net.
```

Запит на передачу зони тепер можна зробити до серверів імен для домену example.com. Якщо тестувальнику пощастить, він отримає список записів DNS для цього домену. Серед них будуть очевидні `www.example.com`, а також менш очевидні, як-от `helpdesk.example.com` та `webmail.example.com` (і, можливо, інші). Перевірте всі імена, отримані в результаті передачі зони, і враховуйте всі ті, які пов'язані з цільовим об'єктом, що оцінюється.

Спроба зробити запит на передачу зони для `owasp.org` з одного з його серверів імен:

```
$ host -l www.owasp.org ns1.secure.net
Using domain server:
Name: ns1.secure.net
Address: 192.220.124.10#53
Aliases:

Host www.owasp.org not found: 5(REFUSED)
; Transfer failed.
```

### DNS-запити навпаки (Inverse Queries)
Цей процес схожий на попередній, але використовує зворотні DNS-записи (PTR). Замість запиту на передачу зони спробуйте встановити тип запису як PTR і виконати запит на задану IP-адресу. Якщо тестувальникам пощастить, вони можуть отримати запис із DNS-ім'ям. Цей метод залежить від наявності карт відповідності IP-адрес символічним іменам, що не завжди гарантується.
### Пошук DNS через веб-сервіси
Цей вид пошуку схожий на передачу зони DNS, але базується на веб-сервісах, які дозволяють виконувати пошук імен у DNS. Одним із таких сервісів є [Netcraft Search DNS](https://searchdns.netcraft.com/?host). Тестувальник може виконати запит, щоб отримати список імен, що належать до вибраного домену, наприклад, `example.com`. Потім вони перевіряють, чи відповідають отримані імена цілям, які вони досліджують.
### Сервіси зворотного пошуку IP-адрес (Reverse-IP Services)
Сервіси зворотного пошуку IP-адрес подібні до DNS-запитів навпаки, але замість сервера імен тестувальники використовують веб-додаток. Таких сервісів доступно багато. Оскільки вони часто надають лише часткові (і різні) результати, краще використовувати кілька таких сервісів для отримання більш повного аналізу.

- **[Domain Tools Reverse IP](https://www.domaintools.com/reverse-ip/)** (вимагає безкоштовної реєстрації)

- **[Bing](https://bing.com/)**, синтаксис: `ip:x.x.x.x`
  
- **[Webhosting Info](http://whois.webhosting.info/)**, синтаксис: `http://whois.webhosting.info/x.x.x.x`

- **[DNSstuff](https://www.dnsstuff.com/)** (доступні різні сервіси)

- **[Net Square](https://web.archive.org/web/20190515092354/http://www.net-square.com/mspawn.html)** (декілька запитів на домени та IP-адреси, вимагає встановлення)

У наступному прикладі показано результат запиту до одного з вищезазначених сервісів Reverse-IP для IP-адреси `216.48.3.18`, яка належить `www.owasp.org`. Виявлено три додаткові несподівані символьні імена, які відповідають цій самій адресі.

![OWASP Information Gathering](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/images/Owasp-Info.jpg)

*Figure 4.1.4-1: OWASP Whois Info*

### Гуглінг
Після збору інформації за допомогою попередніх методів, тестувальники можуть скористатися пошуковими системами для уточнення та розширення свого аналізу. Це може дати докази наявності додаткових символічних імен, що належать цілі, або програм, доступних через неочевидні URL.

Наприклад, беручи до уваги попередній приклад із `www.owasp.org`, тестувальник може запитувати в Google та інших пошукових системах інформацію (тобто DNS-імена), пов'язану з нещодавно виявленими доменами `webgoat.org`, `webscarab.com` і `webscarab.net`.

Методи гуглінгу пояснюються в розділі [Testing: Spiders, Robots, and Crawlers](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage).

## Інструменти
- Інструменти для пошуку DNS, такі як `nslookup`, `dig` та інші подібні.
- Пошукові системи (Google, Bing та інші основні пошукові системи).
- Спеціалізовані веб-сервіси для пошуку, пов'язаного з DNS: див. текст.
- [Nmap](https://nmap.org/)
- [Сканер вразливостей Nessus](https://www.tenable.com/products/nessus)
- [Nikto](https://www.cirt.net/nikto2)
