# Тестування обробки розширень файлів для чутливої інформації
| ID |
|---|
| WSTG-CONF-03 |
## Підсумок
Розширення файлів зазвичай використовуються на веб-серверах для визначення необхідних технологій, мов програмування та плагінів, які потрібні для обробки веб-запиту. Хоча така поведінка відповідає RFC та веб-стандартам, використання стандартних розширень файлів надає пентестеру корисну інформацію про технології, які використовуються у веб-середовищі, і значно спрощує завдання визначення сценарію атаки для конкретних технологій. Крім того, неправильна конфігурація веб-серверів може легко розкрити конфіденційну інформацію, наприклад, облікові дані доступу.

Перевірка розширень файлів часто використовується для валідації файлів, які завантажуються, що може призводити до неочікуваних результатів через те, що вміст файлу не відповідає очікуваному, або через несподівану поведінку файлових систем операційних систем.

Визначення того, як веб-сервери обробляють запити до файлів із різними розширеннями, може допомогти зрозуміти їхню поведінку залежно від типу файлів, до яких здійснюється доступ. Наприклад, це може допомогти з’ясувати, які розширення файлів повертаються як текст чи звичайний текст, а які викликають виконання на стороні сервера. Останнє може свідчити про використання певних технологій, мов програмування чи плагінів на веб- або серверних додатках і може надати додаткову інформацію про те, як побудована веб-аплікація. Наприклад, розширення ".pl" зазвичай асоціюється з підтримкою Perl на стороні сервера. Однак розширення файлів може вводити в оману й не бути остаточним доказом. Наприклад, серверні ресурси Perl можуть бути перейменовані, щоб приховати їхнє походження. Дивіться наступний розділ "Компоненти веб-сервера" для отримання додаткової інформації про ідентифікацію серверних технологій та компонентів.

## Цілі тестування
- Провести Dirbust для виявлення чутливих розширень файлів або розширень, які можуть містити необроблені дані (наприклад, скрипти, необроблені дані, облікові дані тощо).
- Перевірити, що не існує можливостей обходу системного фреймворку на основі встановлених правил.

## Як тестувати
### Примусовий перегляд
Надсилайте запити з різними розширеннями файлів і перевіряйте, як вони обробляються. Перевірка має здійснюватися на основі кожного веб-каталогу. Перевірте каталоги, які дозволяють виконання сценарію. Каталоги веб-серверів можна ідентифікувати за допомогою інструментів сканування, які шукають наявність добре відомих каталогів. Крім того, дзеркальне відображення структури веб-сайту дозволяє тестувальнику реконструювати дерево веб-каталогів, які обслуговує додаток.

Якщо архітектура веб-програми збалансована, важливо оцінити всі веб-сервери. Це може бути або непросто, залежно від конфігурації інфраструктури балансування. В інфраструктурі із резервними компонентами можуть бути невеликі відмінності в конфігурації окремих веб-серверів або серверів програм. Це може статися, якщо у веб-архітектурі використовуються різнорідні технології (подумайте про набір веб-серверів IIS і Apache у конфігурації балансування навантаження, що може викликати невелику асиметричну поведінку між ними та, можливо, різні вразливості).

#### Приклад
Тестер виявив існування файлу з назвою **connection.inc**. Спроба отримати доступ до нього безпосередньо повертає його вміст, який виглядає так:
```
<?
    mysql_connect("127.0.0.1", "root", "password")
        or die("Could not connect");
?>
```
Тестер визначає наявність бекенду MySQL DBMS і слабкі облікові дані, які використовуються веб-додатком для доступу до нього.

Наступні розширення файлів ніколи не повинні повертатися веб-сервером, оскільки вони пов'язані з файлами, які можуть містити конфіденційну інформацію, або з файлами, для яких немає причин бути доступними:

- ```.asa```
- ```.inc```
- ```.config```

Наступні розширення файлів пов'язані з файлами, які при доступі до них або відображаються, або завантажуються у браузері. Тому файли з цими розширеннями необхідно перевірити, щоб переконатися, що вони дійсно мають бути доступними (а не є залишковими), і що вони не містять конфіденційної інформації.

- ```.zip```, ```.tar```, ```.gz```, ```.tgz```, ```.rar``` тощо: (Стислі) архівні файли  
- ```.java```: Немає причин надавати доступ до вихідних файлів Java  
- ```.txt```: Текстові файли  
- ```.pdf```: Документи PDF  
- ```.docx```, ```.rtf```, ```.xlsx```, ```.pptx``` тощо: Офісні документи  
- ```.bak```, ```.old``` та інші розширення, що вказують на резервні копії файлів (наприклад, для резервних файлів Emacs)

Наведений вище список містить лише кілька прикладів, оскільки існує занадто багато розширень файлів, щоб охопити їх усі. Для більш детальної бази даних розширень файлів зверніться до [FILExt](https://filext.com/).

Для ідентифікації файлів із заданим розширенням можна використовувати поєднання різних технік. До таких технік належать сканери вразливостей, інструменти для сканування та дзеркалювання, ручна перевірка застосунків (це допомагає подолати обмеження автоматичного сканування), використання пошукових систем (див. [Testing: Spidering and googling](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage)). Див. також розділ [Testing for Old, Backup and Unreferenced Files](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information), у якому розглядаються питання безпеки, пов’язані з «забутими» файлами.

### Завантаження файлу

Обробка файлів у спадковому форматі Windows 8.3 іноді може використовуватися для обходу фільтрів завантаження файлів.

**Приклади використання:**

- `file.phtml` обробляється як PHP-код.  
- `FILE~1.PHT` відображається, але не обробляється PHP ISAPI-обробником.  
- `shell.phPWND` може бути завантажений.  
- `SHELL~1.PHP` буде розширено й повернуто оболонкою ОС, після чого оброблено PHP ISAPI-обробником.

### Тестування в сірій коробці

Виконання білого тестування щодо обробки розширень файлів полягає в перевірці конфігурацій веб-серверів або серверів додатків, які є частиною архітектури веб-застосунку, і верифікації того, як вони налаштовані для обробки різних розширень файлів.

Якщо веб-застосунок покладається на інфраструктуру з балансуванням навантаження та різними компонентами, необхідно визначити, чи може це призвести до різної поведінки.

## Інструменти

Сканери вразливостей, такі як Nessus та Nikto, перевіряють наявність відомих веб-директорій. Вони можуть дозволити тестувальнику завантажити структуру вебсайту, що є корисним для визначення конфігурації веб-директорій та того, як обробляються окремі розширення файлів. Інші інструменти, які можна використовувати для цієї мети, включають:

- [wget](https://www.gnu.org/software/wget)
- [curl](https://curl.haxx.se/)
- пошук в Google за запитом “інструменти для дзеркалювання вебсайтів”.
